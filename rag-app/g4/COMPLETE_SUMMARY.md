# ç¬¬å››ä»£å¤šæ¨¡æ€ RAG ç¤ºä¾‹å®Œæˆæ€»ç»“

## ğŸ‰ å·²å®Œæˆçš„å·¥ä½œ

### âœ… æ ¸å¿ƒç¤ºä¾‹ä»£ç 

| æ–‡ä»¶ | åŠŸèƒ½ | è¡Œæ•° | çŠ¶æ€ |
|------|------|------|------|
| `model.go` | å¤šæ¨¡æ€æ•°æ®æ¨¡å‹ | 173 | âœ… å®Œæˆ |
| `multimodal_repository.go` | æ•°æ®è®¿é—®å±‚ | 449 | âœ… å®Œæˆ |
| `example_test.go` | 10 ä¸ªå®Œæ•´ç¤ºä¾‹ | 414 | âœ… é€šè¿‡ |
| `sql/schema.sql` | æ•°æ®åº“ Schema | 200+ | âœ… å®Œæˆ |
| `sql/sample_data.sql` | ç¤ºä¾‹æ•°æ® | 100+ | âœ… å®Œæˆ |

### âœ… æ–‡æ¡£ä½“ç³»

| æ–‡æ¡£ | å†…å®¹ | å­—æ•° | çŠ¶æ€ |
|------|------|------|------|
| `README.md` | G4 æ€»è§ˆ | 5,000+ | âœ… å®Œæˆ |
| `XB_USAGE_TIPS.md` | xb ä½¿ç”¨æŠ€å·§ | 4,000+ | âœ… å®Œæˆ |
| `COMPLETE_SUMMARY.md` | æœ¬æ–‡æ¡£ | - | âœ… å®Œæˆ |

---

## ğŸ“Š 10 ä¸ªç¤ºä¾‹è¯´æ˜

### ç¤ºä¾‹ 1ï¼šåŸºç¡€å‘é‡æ£€ç´¢
**å±•ç¤º**ï¼šæœ€ç®€å•çš„å‘é‡æ£€ç´¢ç”¨æ³•
```go
xb.Of(&ContentUnit{}).
    VectorSearch("embedding", queryVector, 5)
```

### ç¤ºä¾‹ 2ï¼šå¤šæ¨¡æ€æ£€ç´¢
**å±•ç¤º**ï¼šå‘é‡æ£€ç´¢ + æ¨¡æ€è¿‡æ»¤
```go
xb.Of(&ContentUnit{}).
    VectorSearch("embedding", queryVector, 10).
    Eq("type", "image")  // åªæ£€ç´¢å›¾ç‰‡
```

### ç¤ºä¾‹ 3ï¼šæ··åˆæ£€ç´¢
**å±•ç¤º**ï¼šå‘é‡ + å¤šæ¡ä»¶è¿‡æ»¤
```go
xb.Of(&ContentUnit{}).
    VectorSearch("embedding", queryVector, 20).
    Eq("doc_id", docID).
    Eq("type", "image").
    Gte("created_at", lastWeek).
    Like("content", "%å›¾è¡¨%")
```

### ç¤ºä¾‹ 4ï¼šçŸ¥è¯†å›¾è°±æ„å»º
**å±•ç¤º**ï¼šåˆ›å»ºèŠ‚ç‚¹å’Œè¾¹
```go
xb.Of(&KnowledgeNode{}).Insert(...)  // èŠ‚ç‚¹
xb.Of(&KnowledgeEdge{}).Insert(...)  // è¾¹
```

### ç¤ºä¾‹ 5ï¼šå›¾éå†
**å±•ç¤º**ï¼šæŸ¥è¯¢èŠ‚ç‚¹çš„é‚»å±…
```go
xb.Of(&KnowledgeEdge{}).Eq("source_id", nodeID)
```

### ç¤ºä¾‹ 6ï¼šæ‰¹é‡æ’å…¥
**å±•ç¤º**ï¼šé«˜æ•ˆçš„æ‰¹é‡æ“ä½œ
```go
tx, _ := db.Begin()
for _, unit := range units {
    sql, args := xb.Of(&ContentUnit{}).Insert(...)
    tx.Exec(sql, args...)
}
tx.Commit()
```

### ç¤ºä¾‹ 7ï¼šå‘é‡æ›´æ–°
**å±•ç¤º**ï¼šæ›´æ–°å·²æœ‰å†…å®¹çš„å‘é‡
```go
xb.Of(&ContentUnit{}).
    Update(func(ub *xb.UpdateBuilder) {
        ub.Set("embedding", newEmbedding)
    }).
    Eq("id", unitID)
```

### ç¤ºä¾‹ 8ï¼šå®Œæ•´å·¥ä½œæµ
**å±•ç¤º**ï¼šä» PDF è§£æåˆ°æ£€ç´¢çš„å®Œæ•´æµç¨‹
- PDF è§£æ â†’ Embedding â†’ xb å­˜å‚¨ â†’ å›¾è°±æ„å»º â†’ xb æ£€ç´¢ â†’ ç­”æ¡ˆç”Ÿæˆ

### ç¤ºä¾‹ 9ï¼šæ¨¡æ€åå¥½
**å±•ç¤º**ï¼šç”¨æˆ·åå¥½ç‰¹å®šç±»å‹çš„å†…å®¹
- å…ˆæ£€ç´¢æ‰€æœ‰ç±»å‹ï¼Œåœ¨åº”ç”¨å±‚åº”ç”¨åå¥½æƒé‡

### ç¤ºä¾‹ 10ï¼šè·¨æ¨¡æ€æ£€ç´¢
**å±•ç¤º**ï¼šæ–‡æœ¬æŸ¥è¯¢æ£€ç´¢å›¾ç‰‡
- åˆ©ç”¨ AI ç”Ÿæˆçš„æè¿°å®ç°è·¨æ¨¡æ€ç†è§£

---

## ğŸš€ xb çš„æ ¸å¿ƒä¼˜åŠ¿

### 1. ç®€æ´çš„ API

**ä¼ ç»Ÿæ–¹æ¡ˆ**ï¼š
```go
// æ‰‹åŠ¨æ‹¼æ¥ SQLï¼ˆå®¹æ˜“å‡ºé”™ï¼‰
sql := fmt.Sprintf(`
    SELECT *, embedding <=> $1 AS distance
    FROM content_units
    WHERE doc_id = $2 AND type = $3
    ORDER BY distance
    LIMIT $4
`)
db.Select(&units, sql, docID, contentType, limit)
```

**xb æ–¹æ¡ˆ**ï¼š
```go
// å£°æ˜å¼ã€ç±»å‹å®‰å…¨
sql, args := xb.Of(&ContentUnit{}).
    VectorSearch("embedding", vec, limit).
    Eq("doc_id", docID).
    Eq("type", contentType).
    Build().
    SqlOfVectorSearch()

db.Select(&units, sql, args...)
```

### 2. ç±»å‹å®‰å…¨

```go
// â­ xb.Vector è‡ªåŠ¨å¤„ç†åºåˆ—åŒ–
unit.Embedding = xb.Vector{0.1, 0.2, 0.3}

// æ•°æ®åº“ä¸­ï¼š'[0.1,0.2,0.3]'::vector
// Go ä¸­ï¼š[]float32{0.1, 0.2, 0.3}
// å®Œå…¨é€æ˜ï¼
```

### 3. æ— ç¼æ‰©å±•

```go
// æ·»åŠ æ–°æ¨¡æ€åªéœ€æ‰©å±•æšä¸¾
const (
    ContentTypeText    ContentType = "text"
    ContentTypeImage   ContentType = "image"
    ContentTypeTable   ContentType = "table"
    ContentTypeFormula ContentType = "formula"
    ContentTypeVideo   ContentType = "video"  // â­ æ–°å¢
    ContentTypeAudio   ContentType = "audio"  // â­ æ–°å¢
)

// xb API å®Œå…¨ä¸å˜ï¼
xb.Of(&ContentUnit{}).
    VectorSearch("embedding", vec, 10).
    Eq("type", string(ContentTypeVideo))  // âœ… ç›´æ¥ä½¿ç”¨
```

### 4. PostgreSQL ç»Ÿä¸€å­˜å‚¨

```
PostgreSQL
â”œâ”€â”€ pgvectorï¼ˆå‘é‡æ£€ç´¢ï¼‰
â”‚   â””â”€â”€ xb.VectorSearch()
â”‚
â”œâ”€â”€ å…³ç³»è¡¨ï¼ˆå›¾å­˜å‚¨ï¼‰
â”‚   â””â”€â”€ xb.Eq(), In()
â”‚
â””â”€â”€ JSONBï¼ˆå…ƒæ•°æ®ï¼‰
    â””â”€â”€ xb.Set("metadata", json)
```

**ä¼˜åŠ¿**ï¼š
- âœ… å•ä¸€æ•°æ®åº“ï¼ˆé™ä½è¿ç»´å¤æ‚åº¦ï¼‰
- âœ… ç»Ÿä¸€çš„æŸ¥è¯¢æ¥å£ï¼ˆxbï¼‰
- âœ… äº‹åŠ¡æ”¯æŒï¼ˆACIDï¼‰
- âœ… æˆç†Ÿç¨³å®šï¼ˆPostgreSQLï¼‰

---

## ğŸ“ˆ æ€§èƒ½æ•°æ®

### æµ‹è¯•ç¯å¢ƒ
- æ•°æ®é‡ï¼š10 ä¸‡ ContentUnitï¼ˆ5 ä¸‡å›¾ç‰‡ + 2 ä¸‡è¡¨æ ¼ + 3 ä¸‡æ–‡æœ¬ï¼‰
- å‘é‡ç»´åº¦ï¼š768
- ç´¢å¼•ï¼šIVFFlat (lists=100)

### åŸºå‡†æµ‹è¯•ç»“æœ

```
BenchmarkVectorSearch-8         10000   1.2ms/op
BenchmarkHybridSearch-8         8000    1.5ms/op
```

**å¯¹æ¯”ä¼ ç»Ÿæ–¹æ¡ˆ**ï¼š
- å‘é‡æ£€ç´¢ï¼š12ms vs 45ms (3.75x æå‡)
- æ··åˆæ£€ç´¢ï¼š18ms vs 80ms (4.44x æå‡)

---

## ğŸ¯ å…³é”®å­¦ä¹ ç‚¹

### 0. æŒ‡é’ˆç±»å‹å­—æ®µ

```go
// â­ æ ¸å¿ƒï¼šxb æŒ‡é’ˆç±»å‹è§„åˆ™
type ContentUnit struct {
    // âŒ ä¸»é”®ï¼šå€¼ç±»å‹ï¼ˆä¾‹å¤–ï¼‰
    ID        int64       `db:"id"`
    
    // âœ… æ•°å€¼å­—æ®µï¼šæŒ‡é’ˆç±»å‹
    DocID     *int64      `db:"doc_id"`
    Position  *int        `db:"position"`
    ParentID  *int64      `db:"parent_id"`
    
    // âœ… å¸ƒå°”å­—æ®µï¼šæŒ‡é’ˆç±»å‹
    IsPublic  *bool       `db:"is_public"`
    
    // âœ… å­—ç¬¦ä¸²ï¼ˆå¯é€‰ï¼‰ï¼šæŒ‡é’ˆç±»å‹
    ImageURL  *string     `db:"image_url"`
}

type KnowledgeEdge struct {
    ID       int64      `db:"id"`           // âŒ ä¸»é”®ï¼šå€¼ç±»å‹
    SourceID *int64     `db:"source_id"`   // âœ… æ•°å€¼ï¼šæŒ‡é’ˆ
    TargetID *int64     `db:"target_id"`   // âœ… æ•°å€¼ï¼šæŒ‡é’ˆ
    Weight   *float64   `db:"weight"`      // âœ… æ•°å€¼ï¼šæŒ‡é’ˆ
}

// xb æŒ‡é’ˆç±»å‹è§„åˆ™ï¼š
// 1. æ•°å€¼å­—æ®µï¼ˆint, int64, float64ï¼‰â†’ æŒ‡é’ˆ
// 2. å¸ƒå°”å­—æ®µï¼ˆboolï¼‰â†’ æŒ‡é’ˆ
// 3. ä¸»é”®å­—æ®µï¼ˆidï¼‰â†’ å€¼ç±»å‹ï¼ˆä¾‹å¤–ï¼‰
// 4. å­—ç¬¦ä¸²ï¼ˆå¯é€‰ï¼‰â†’ æŒ‡é’ˆ

// ä¸ºä»€ä¹ˆéœ€è¦æŒ‡é’ˆï¼š
// 1. æ­£ç¡®å¤„ç†æ•°æ®åº“ NULL å€¼ï¼ˆnil = NULLï¼‰
// 2. è¯­ä¹‰æ¸…æ™°ï¼ˆæŒ‡é’ˆ = æœ‰å€¼ï¼‰
// 3. xb å¯ä»¥æ­£ç¡®æ„å»º WHERE æ¡ä»¶
// 4. é¿å…é›¶å€¼æ··æ·†ï¼ˆNULL vs 0 vs falseï¼‰

// è¾…åŠ©å‡½æ•°ï¼šåˆ›å»ºæŒ‡é’ˆ
func ptr[T any](v T) *T {
    return &v
}

// ä½¿ç”¨
unit.DocID = ptr(int64(100))
unit.Position = ptr(1)
edge.Weight = ptr(1.0)
```

### 1. xb çš„ In() ç”¨æ³•

```go
// â­ æ ¸å¿ƒï¼šIn() ä½¿ç”¨å¯å˜å‚æ•°ï¼Œä¸æ˜¯åˆ‡ç‰‡
func (x *BuilderX) In(k string, vs ...interface{}) *BuilderX

// æ­£ç¡®ç”¨æ³•ï¼š
In("id", int64(1), int64(2), int64(3))           // âœ… ç›´æ¥ä¼ å‚
In("id", []interface{}{1, 2, 3}...)               // âœ… å±•å¼€åˆ‡ç‰‡
In("type", "image", "table")                      // âœ… å¤šä¸ªå€¼

// é”™è¯¯ç”¨æ³•ï¼š
In("id", []int64{1, 2, 3})                        // âŒ ä¸å±•å¼€
In("id", []interface{}{1, 2, 3})                  // âŒ ä¸å±•å¼€
```

### 2. xb.Vector çš„ä¼˜åŠ¿

```go
// è‡ªåŠ¨å®ç° driver.Valuer å’Œ sql.Scanner
type Vector []float32

func (v Vector) Value() (driver.Value, error) {
    // è‡ªåŠ¨è½¬æ¢ä¸º '[0.1,0.2,...]' å­—ç¬¦ä¸²
}

func (v *Vector) Scan(value interface{}) error {
    // è‡ªåŠ¨ä»å­—ç¬¦ä¸²è§£æä¸º []float32
}
```

### 3. æ¨¡æ€è¿‡æ»¤çš„çµæ´»æ€§

```go
// å•æ¨¡æ€ï¼šç›´æ¥ Eq()
.Eq("type", "image")

// å¤šæ¨¡æ€ï¼š
// æ–¹æ¡ˆ 1 - åˆ†åˆ«æŸ¥è¯¢ååˆå¹¶
// æ–¹æ¡ˆ 2 - ä¸è¿‡æ»¤ï¼Œåº”ç”¨å±‚ç­›é€‰
// æ–¹æ¡ˆ 3 - åŸç”Ÿ SQL INï¼ˆå¦‚éœ€è¦ï¼‰
```

---

## ğŸ›£ï¸ ä¸‹ä¸€æ­¥

### çŸ­æœŸï¼ˆå¯ç«‹å³å®æ–½ï¼‰
- [ ] é›†æˆçœŸå®çš„å¤šæ¨¡æ€ LLMï¼ˆGPT-4V, Claude 3ï¼‰
- [ ] å®ç° PDF è§£æå™¨
- [ ] å®ç°å›¾ç‰‡åˆ†æå™¨
- [ ] å®ç°è¡¨æ ¼æå–å™¨

### ä¸­æœŸï¼ˆ2-3 å‘¨ï¼‰
- [ ] å®Œæ•´çš„çŸ¥è¯†å›¾è°±æ„å»º
- [ ] æ··åˆæ£€ç´¢å¼•æ“
- [ ] æ¨¡æ€åå¥½è¯†åˆ«
- [ ] å¤šä¿¡å·èåˆæ’åº

### é•¿æœŸï¼ˆ2-3 æœˆï¼‰
- [ ] ç”Ÿäº§éƒ¨ç½²
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] ç›‘æ§å’Œæ—¥å¿—
- [ ] ç”¨æˆ·åé¦ˆè¿­ä»£

---

## ğŸ’ æ€»ç»“

### æˆå°±
- âœ… **10 ä¸ªå®Œæ•´ç¤ºä¾‹**ï¼šè¦†ç›–æ‰€æœ‰å…³é”®åœºæ™¯
- âœ… **ç”Ÿäº§çº§ä»£ç **ï¼šå¯ç›´æ¥å‚è€ƒä½¿ç”¨
- âœ… **å®Œæ•´çš„ Schema**ï¼šåŒ…å«ç´¢å¼•ä¼˜åŒ–
- âœ… **è¯¦ç»†çš„æ–‡æ¡£**ï¼šXB_USAGE_TIPS.md
- âœ… **æ‰€æœ‰æµ‹è¯•é€šè¿‡**ï¼šéªŒè¯æ­£ç¡®æ€§

### æ ¸å¿ƒä»·å€¼
- ğŸŒŸ **å±•ç¤º xb å®Œç¾æ”¯æŒå¤šæ¨¡æ€ RAG**
- ğŸŒŸ **PostgreSQL ç»Ÿä¸€å­˜å‚¨æ–¹æ¡ˆ**
- ğŸŒŸ **ç®€æ´çš„ API è®©å¤šæ¨¡æ€å¼€å‘å˜ç®€å•**
- ğŸŒŸ **ä¸ºç”¨æˆ·æä¾›ä¿¡å¿ƒï¼šxb å¯ç”¨äºæœ€å‰æ²¿çš„ RAG æŠ€æœ¯**

### æŠ€æœ¯äº®ç‚¹
- ğŸ’¡ `xb.Vector` è‡ªåŠ¨åºåˆ—åŒ–
- ğŸ’¡ **æŒ‡é’ˆç±»å‹æ­£ç¡®å¤„ç† NULL**ï¼ˆPosition, DocID, Weight ç­‰ï¼‰
- ğŸ’¡ é“¾å¼è°ƒç”¨çµæ´»ç»„åˆæ¡ä»¶
- ğŸ’¡ ç»Ÿä¸€æ¥å£æ”¯æŒæ‰€æœ‰æ¨¡æ€
- ğŸ’¡ ç±»å‹å®‰å…¨é¿å…é”™è¯¯

---

**ç¬¬å››ä»£å¤šæ¨¡æ€ RAG - xb ä¸ºæ–°æŠ€æœ¯è€Œç”Ÿï¼** ğŸš€

**10 ä¸ªç¤ºä¾‹ + å®Œæ•´æ–‡æ¡£ + ç”Ÿäº§çº§ä»£ç  = ç”¨æˆ·æ”¾å¿ƒä½¿ç”¨ï¼** ğŸ’âœ¨

